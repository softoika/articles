---
title: "[Angular] Promiseを使うべきかObservableを使うべきかみたいな話"
emoji: "🤔"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["angular"]
published: false
---
AngularにはRxJSという非同期処理ライブラリがビルトインで入っています。
RxJSは非同期処理をする際にオブザーバーパターンのような恩恵を受けられるメリットがあります。
Angularの公式チュートリアルを見れば非同期処理はすべてRxJSで書かれていますが、
一方でJavaScript(ES2015以降)にはPromiseという非同期処理の仕組みがあります。
RxJSとPromiseどちらをどういうときに使えばいいのでしょうか？
この記事では両者の性質を踏まえた上でRxJSに向くケースとPromiseに向くケースについて考えてみたいと思います。

# Promiseの簡単なおさらい
PromiseはES2015に登場した非同期処理の仕組みです。
大まかに説明すると`Promise.then()`で非同期的な実行をすることができ、async/await構文で同期的にも書けます。
```ts
// 1→2の順で実行される
new Promise((resolve) => {setTimeout(() => resolve(2), 1000)})
  .then((n) => console.log(n));
console.log(1);
```
```ts
function asyncRandom(n: number): Promise<number> {
  return new Promise((resolve) => setTimeout(() => resolve(n), Math.random() * 1000));
}
// 実行順は毎回異なる
asyncRandom(1).then((n) => console.log(n));
asyncRandom(2).then((n) => console.log(n));
asyncRandom(3).then((n) => console.log(n));

async function run() {
  // 上から下に順番に実行される
  let n = await asyncRandom(1);
  console.log(n);
  n = await asyncRandom(2);
  console.log(n);
  n = await asyncRandom(3);
  console.log(n);
}
run();
```

# RxJSを使うメリット
Promiseとは異なり、非同期的な変更を継続的に受け取れる。
オブザーバーパターン
どういうときに役立つか。定期的な非同期処理の実行、受け取り。単方向データフロー
Hot/Coldという概念

## Observable
## Subject
## asyncパイプ
# RxJSを使うデメリット
operatorの種類が多く、自由度が高い→同じようなことを実現するにしても書き方に差が出る
フロントエンドで１度のアクションに対して複数の非同期処理が絡む場合、複雑な書き方が要求される場合がある
switchMapやcombineLatestなど
その場合にはPromiseとasync/awaitを使った方がシンプルに書ける(経験上)
